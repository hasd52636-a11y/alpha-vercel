<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è¿æ¥æµ‹è¯• - æœ¬åœ°å®¢æˆ·ç«¯ä¸éƒ¨ç½²æœåŠ¡å™¨</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    .container {
      background: white;
      border-radius: 10px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      color: #333;
    }
    h1 {
      color: #667eea;
      margin-bottom: 30px;
    }
    .test-section {
      margin-bottom: 30px;
      padding: 20px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      background: #f9f9f9;
    }
    .test-section h2 {
      color: #764ba2;
      margin-bottom: 15px;
    }
    .status {
      padding: 10px;
      border-radius: 5px;
      margin: 10px 0;
      font-weight: bold;
    }
    .success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    .info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }
    button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      margin: 5px;
      transition: transform 0.2s;
    }
    button:hover {
      transform: scale(1.05);
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    .result {
      margin-top: 15px;
      padding: 15px;
      background: white;
      border-radius: 5px;
      border: 1px solid #ddd;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ”— è¿æ¥æµ‹è¯• - æœ¬åœ°å®¢æˆ·ç«¯ä¸éƒ¨ç½²æœåŠ¡å™¨</h1>
    
    <div class="test-section">
      <h2>ğŸ“Š é…ç½®ä¿¡æ¯</h2>
      <div class="status info">
        <strong>æœ¬åœ°å®¢æˆ·ç«¯:</strong> http://localhost:3004<br>
        <strong>éƒ¨ç½²æœåŠ¡å™¨:</strong> https://sora2.wboke.com<br>
        <strong>API ä»£ç†:</strong> https://sora2.wboke.com/api
      </div>
    </div>

    <div class="test-section">
      <h2>ğŸ§ª æµ‹è¯•é¡¹ç›®</h2>
      
      <div id="test1">
        <h3>æµ‹è¯• 1: æœåŠ¡å™¨è¿æ¥</h3>
        <button onclick="testServerConnection()">æµ‹è¯•è¿æ¥</button>
        <div id="result1" class="result">ç­‰å¾…æµ‹è¯•...</div>
      </div>
      
      <div id="test2">
        <h3>æµ‹è¯• 2: API è°ƒç”¨</h3>
        <button onclick="testAPICall()">æµ‹è¯• API</button>
        <div id="result2" class="result">ç­‰å¾…æµ‹è¯•...</div>
      </div>
      
      <div id="test3">
        <h3>æµ‹è¯• 3: AI å“åº”</h3>
        <button onclick="testAIResponse()">æµ‹è¯• AI</button>
        <div id="result3" class="result">ç­‰å¾…æµ‹è¯•...</div>
      </div>
    </div>

    <div class="test-section">
      <h2>ğŸ“ æµ‹è¯•æ€»ç»“</h2>
      <div id="summary" class="result">ç­‰å¾…æ‰€æœ‰æµ‹è¯•å®Œæˆ...</div>
    </div>
  </div>

  <script>
    const testResults = {
      serverConnection: false,
      apiCall: false,
      aiResponse: false
    };

    async function testServerConnection() {
      const resultDiv = document.getElementById('result1');
      resultDiv.innerHTML = '<span class="loading"></span> æµ‹è¯•ä¸­...';
      
      try {
        const response = await fetch('https://sora2.wboke.com/', {
          method: 'GET',
          mode: 'cors'
        });
        
        if (response.ok) {
          resultDiv.innerHTML = '<div class="status success">âœ… æœåŠ¡å™¨è¿æ¥æˆåŠŸï¼</div>';
          testResults.serverConnection = true;
        } else {
          resultDiv.innerHTML = `<div class="status error">âŒ æœåŠ¡å™¨å“åº”é”™è¯¯: ${response.status}</div>`;
        }
      } catch (error) {
        resultDiv.innerHTML = `<div class="status error">âŒ è¿æ¥å¤±è´¥: ${error.message}</div>`;
      }
      
      updateSummary();
    }

    async function testAPICall() {
      const resultDiv = document.getElementById('result2');
      resultDiv.innerHTML = '<span class="loading"></span> æµ‹è¯•ä¸­...';
      
      try {
        const response = await fetch('/api/chat', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            message: 'æµ‹è¯•æ¶ˆæ¯',
            knowledgeBase: [],
            provider: 'zhipu',
            systemPrompt: 'ä½ æ˜¯ä¸€ä¸ªæµ‹è¯•åŠ©æ‰‹',
            options: {
              stream: false,
              temperature: 0.7,
              maxTokens: 50
            }
          })
        });
        
        if (response.ok) {
          const data = await response.json();
          resultDiv.innerHTML = '<div class="status success">âœ… API è°ƒç”¨æˆåŠŸï¼</div>';
          resultDiv.innerHTML += `<div class="result">å“åº”: ${JSON.stringify(data, null, 2)}</div>`;
          testResults.apiCall = true;
        } else {
          const errorText = await response.text();
          resultDiv.innerHTML = `<div class="status error">âŒ API è°ƒç”¨å¤±è´¥: ${response.status}</div>`;
          resultDiv.innerHTML += `<div class="result">é”™è¯¯: ${errorText}</div>`;
        }
      } catch (error) {
        resultDiv.innerHTML = `<div class="status error">âŒ API è°ƒç”¨å¼‚å¸¸: ${error.message}</div>`;
      }
      
      updateSummary();
    }

    async function testAIResponse() {
      const resultDiv = document.getElementById('result3');
      resultDiv.innerHTML = '<span class="loading"></span> æµ‹è¯•ä¸­...';
      
      try {
        const response = await fetch('/api/chat', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            message: 'ä½ å¥½ï¼Œè¯·ç”¨ä¸€å¥è¯ä»‹ç»è‡ªå·±',
            knowledgeBase: [],
            provider: 'zhipu',
            systemPrompt: 'ä½ æ˜¯ä¸€ä¸ªå‹å¥½çš„AIåŠ©æ‰‹',
            options: {
              stream: false,
              temperature: 0.7,
              maxTokens: 100
            }
          })
        });
        
        if (response.ok) {
          const data = await response.json();
          resultDiv.innerHTML = '<div class="status success">âœ… AI å“åº”æˆåŠŸï¼</div>';
          resultDiv.innerHTML += `<div class="result">AI å›å¤: ${data.response || data.message || JSON.stringify(data)}</div>`;
          testResults.aiResponse = true;
        } else {
          const errorText = await response.text();
          resultDiv.innerHTML = `<div class="status error">âŒ AI å“åº”å¤±è´¥: ${response.status}</div>`;
          resultDiv.innerHTML += `<div class="result">é”™è¯¯: ${errorText}</div>`;
        }
      } catch (error) {
        resultDiv.innerHTML = `<div class="status error">âŒ AI å“åº”å¼‚å¸¸: ${error.message}</div>`;
      }
      
      updateSummary();
    }

    function updateSummary() {
      const summaryDiv = document.getElementById('summary');
      const allTestsPassed = testResults.serverConnection && testResults.apiCall && testResults.aiResponse;
      
      let summary = '<strong>æµ‹è¯•ç»“æœ:</strong>\n\n';
      summary += `âœ… æœåŠ¡å™¨è¿æ¥: ${testResults.serverConnection ? 'é€šè¿‡' : 'å¤±è´¥'}\n`;
      summary += `âœ… API è°ƒç”¨: ${testResults.apiCall ? 'é€šè¿‡' : 'å¤±è´¥'}\n`;
      summary += `âœ… AI å“åº”: ${testResults.aiResponse ? 'é€šè¿‡' : 'å¤±è´¥'}\n\n`;
      
      if (allTestsPassed) {
        summary += '<div class="status success">ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼æœ¬åœ°å®¢æˆ·ç«¯å¯ä»¥æ­£å¸¸ä¸éƒ¨ç½²çš„æœåŠ¡å™¨é€šè®¯ã€‚</div>';
      } else {
        summary += '<div class="status error">âš ï¸ éƒ¨åˆ†æµ‹è¯•å¤±è´¥ï¼Œè¯·æ£€æŸ¥é…ç½®å’Œç½‘ç»œè¿æ¥ã€‚</div>';
      }
      
      summaryDiv.innerHTML = summary;
    }

    // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œæµ‹è¯•
    window.onload = function() {
      setTimeout(() => {
        testServerConnection();
      }, 1000);
    };
  </script>
</body>
</html>
